# $Id: esanitypcid.soc,v 1.1 Broadcom SDK $
# $Copyright: (c) 2016 Broadcom.
# Broadcom Proprietary and Confidential. All rights reserved.$
#
# Script to run all available tests as quickly as possible.
# For testing basic sanity of new drivers, simulators, chips, etc.

set rctest=f
set rcerror=f

log file=esanitylog.txt append=yes on 

date
ver
soc

linkscan off
init
init misc
init mmu

tc *

echo "Register reset defaults "
tr 1
echo "Done"

echo "Register read/write"
tr 3
echo "Done"

# The following tests are shortened for PLI mode.

echo "Memory Random Addr/Data"
tr51er.soc
echo "Done"

echo "Table DMA"
tdmaer.soc
echo "Done"

rc.soc

counter i=1000000 dma=f pbm=all
sleep 10
counter i=0

echo "XGS L2 Ins/Lookup/Del"
if $?plisim "tr 32 count=4"

echo "Done"

echo "XGS L2 Overflow Ins"
if $?plisim "tr 33 count=4"
echo "Done"

echo "XGS L2 Hashing"
if $?plisim "tr 34 count=256"
echo "Done"

echo "XGS L3 IPV6 Ins/Lookup/Del"
if $?plisim "tr 85 C=4 V=t R=f BIP=1122:3344:5566:7788:9900:aabb:ccdd:eeff \
             SIP=9988:aabb:ccdd:eeff:1122:3344:5566:7788 IPMCE=t; \
             tr 85 C=4 V=t R=f BIP=1122:3344:5566:7788:9900:aabb:ccdd:eeff \
             SIP=9988:aabb:ccdd:eeff:1122:3344:5566:7788 IPMCE=f; \
             "
echo "Done"

echo "XGS L3 IPV6 Overflow Ins"
if $?plisim "tr 86 C=4 V=t R=f BIP=1122:3344:5566:7788:9900:aabb:ccdd:eeff \
             SIP=9988:aabb:ccdd:eeff:1122:3344:5566:7788 IPMCE=f; \
             tr 86 C=4 V=t R=f BIP=1122:3344:5566:7788:9900:aabb:ccdd:eeff \
             SIP=9988:aabb:ccdd:eeff:1122:3344:5566:7788 IPMCE=f; \
            "

echo "Done"
echo "XGS L3 IPV4 Ins/Lookup/Del"
if $?plisim "tr 87 count=4"
echo "Done"

echo "XGS L3 IPV4 Overflow Ins"
if $?plisim "tr 88 count=4"
echo "Done"

echo "Counter widths"
tr 30
echo "Done"

echo "Counter read/write"
tr 31
echo "Done"

echo "CPU Benchmarks"
tr 21
echo "Done"

echo "Linkscan MDIO"
#5 for PCID/QT. Make it 10000 for chip 
if $?plisim "tr 60 R=5"
echo "Done"

testmode +override
set rctest=t
echo "MAC loopback on Ethernet ports"
tr 18 pbm=e PPC=2 C=2 dmi=1
echo "Done"

echo "MAC loopback on HG ports"
tr 18 pbm=hg PPC=2 C=2 dmi=1
echo "Done"

echo 'CPU S/G, Reload'
tr 22 LE=512 LI=192 DI=3 C=1
echo 'Done'

echo 'CPU S/G, Simple'
tr 23 LE=512 LI=192 PPCE=2 DPPI=6 C=1
echo 'Done'

echo 'CPU S/G, Random'
tr 24 LE=512 LI=192 PPCI=3 DVI=3 DI=3 C=1
echo 'Done'

echo "MAC loopback V2 on all ports ..."
tr 48 smi=103 dmi=42 vlan=5 pi=0x11335577 sendm=single

echo "PHY loopback V2 on all ports ..."
tr 49 smi=52 dmi=83 vlan=23 pi=0x01204007 sendm=array

date

#Print the final summary information 
tl

log off
