/* $Id: cint_mpls_various_scenarios.c,v 1.15 Broadcom SDK $
 $Copyright: (c) 2016 Broadcom.
 Broadcom Proprietary and Confidential. All rights reserved.$
 *
 * File: cint_mpls_various_scenarios.c
 * Purpose: Various examples for MPLS/VPLS. 
 */

/* 
 *  
 * Configuration:
 *  
 * cint;                                                                  
 * cint_reset();                                                          
 * exit; 
 * cint ../../../../src/examples/dpp/utility/cint_utils_global.c  
 * cint ../../../../src/examples/dpp/utility/cint_utils_port.c   
 * cint ../../../../src/examples/dpp/utility/cint_utils_l2.c
 * cint ../../../../src/examples/dpp/utility/cint_utils_l3.c 
 * cint ../../../../src/examples/dpp/utility/cint_utils_vlan.c 
 * cint ../../../../src/examples/dpp/utility/cint_utils_multicast.c                     
 * cint ../../../../src/examples/dpp/utility/cint_utils_mpls.c 
 * cint ../../../../src/examples/dpp/utility/cint_utils_mpls_port.c   
 * cint ../../../../src/examples/dpp/cint_vswitch_vpls.c                     
 * cint ../../../../src/examples/dpp/cint_ip_route.c
 * cint ../../../../src/examples/dpp/cint_mpls_various_scenarios.c                                        
 * cint                                                                   
 * int unit = 0; 
 * int rv = 0; 
 * int in_port = 200; 
 * int out_port = 201;
 * rv = mpls_various_scenarios_main(unit,in_port,out_port);
 * print rv; 
 * 
 * 
 *  Scenarios configured in this cint:
 * 
 *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  1) Configuration of egress mpls invalid value
 *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  Test the configuration of mpls egress invalid value.
 *  Set the invalid value:
 * 
 *  mpls_encap_invalid_value=2
 *
 * Traffic represents 4 cases:
 * 1) Send IpoEth, exit with an MPLs encapsulation of two labels with value 0.
 * 2) Send IpoEth, exit with an MPLs encapsulation of one label with value 0. 
 * 3) Send Eth, exit with a PWE label on top of two mpls labels with value 0. The mpls labels are pointed by the pwe entry.
 * 4) Send Eth, exit with a PWE label on top of three mpls labels with value 0. First mpls label is in the PWE entry, which points 
 *    to the other two mpls labels.
 *
 *
 *  Traffic:
 * 
 *  Send the following traffic:
 * 
 *  
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||  SIP     ||  DIP          ||  TTL ||
 *   |    |11:00:00:01:11|01:15||0x8100|20 ||160.0.0.17||160.161.161.162|| 64   ||
 *   |    |              |     ||      |   ||          ||               ||      ||
 *   |    |              |     ||      |   ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * 
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||   MPLS   ||  SIP     ||  DIP          ||  TTL ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:0   ||Label:0   ||160.0.0.17||160.161.161.162|| 64   ||
 *   |    |              |              ||      |   ||Exp:0     ||Exp:0     ||          ||               ||      ||
 *   |    |              |              ||      |   ||TTL:20    ||TTL:20    ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * ###############################################################################################
 *  
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||  SIP     ||  DIP          ||  TTL ||
 *   |    |11:00:00:01:11|01:15||0x8100|20 ||160.0.0.17||160.161.161.163|| 64   ||
 *   |    |              |     ||      |   ||          ||               ||      ||
 *   |    |              |     ||      |   ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * 
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||  SIP     ||  DIP          ||  TTL ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:0   ||160.0.0.17||160.161.161.163|| 64   ||
 *   |    |              |              ||      |   ||Exp:0     ||          ||               ||      ||
 *   |    |              |              ||      |   ||TTL:20    ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * ###############################################################################################
 *    
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:18|01:15||0x8100|15 ||
 *   |    |              |     ||      |   ||
 *   |    |              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||   MPLS   ||   MPLS   ||      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:0   ||Label:0   ||Label:3000||00:00:00:01:18|01:15||0x8100|15 ||
 *   |    |              |              ||      |   ||Exp:0     ||Exp:0     ||Exp:0     ||              |     ||      |   ||
 *   |    |              |              ||      |   ||TTL:20    ||TTL:20    ||TTL:20    ||              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##############################################################################################
 *  
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:19|01:15||0x8100|15 ||
 *   |    |              |     ||      |   ||
 *   |    |              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||   MPLS   ||   MPLS  ||    MPLS   ||      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:0   ||Label:0   ||Label:0  || Label:4000||00:00:00:01:19|01:15||0x8100|15 ||
 *   |    |              |              ||      |   ||Exp:0     ||Exp:0     ||Exp:0    || Exp:0     ||              |     ||      |   ||
 *   |    |              |              ||      |   ||TTL:20    ||TTL:20    ||TTL:20   || TTL:20    ||              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##############################################################################################
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  2) Only in QAX and above devices: Configuration of egress label separate TTL/EXP modes
 *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  Test the configuration of egress label separate TTL/EXP modes.
 *  Set the mpls_various_scenarios_flag_mode value:
 * 
 *  mpls_various_scenarios_flag_mode = 0 - TTL_SET/EXP_SET
 *  mpls_various_scenarios_flag_mode = 1 - TTL_COPY/EXP_SET
 *  mpls_various_scenarios_flag_mode = 2 - TTL_SET/EXP_COPY
 *  mpls_various_scenarios_flag_mode = 3 - TTL_COPY/EXP_COPY
 *
 * Traffic represents 3 cases, whos MPLS/PWE out-going headers will inherit TTL/EXP based on the mode set:
 * 1) Send ETH, exit with a PWEoMPLSoETH encapsulation.
 * 2) Send IPv4oETH, exit with an IPv4oMPLSoETH packet. 
 * 3) Send MPLSoETH, exit with a 2xMPLS labels .
 *
 *
 *  Traffic:
 * 
 *  Send the following traffic:
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *                                                      STAGE 1 - TTL SET + EXP SET
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID|PCP||
 *   |    |00:00:00:01:18|01:15||0x8100|15 |1  ||
 *   |    |              |     ||      |   |   ||
 *   |    |              |     ||      |   |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 || Label:3000||00:00:00:01:18|01:15||0x8100|15 ||
 *   |    |              |              ||      |   ||Exp:2     || Exp:1     ||              |     ||      |   ||
 *   |    |              |              ||      |   ||TTL:20    || TTL:20    ||              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##############################################################################################
 
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||  SIP     ||  DIP          | DSCP | TTL  ||
 *   |    |11:00:00:01:11|01:15||0x8100|20 ||160.0.0.17||160.161.161.162|  4   | 64   ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * 
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||  SIP     ||  DIP          ||  TTL ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 ||160.0.0.17||160.161.161.162|| 63   ||
 *   |    |              |              ||      |   ||Exp:2     ||          ||               ||      ||
 *   |    |              |              ||      |   ||TTL:20    ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * ###############################################################################################
 
 *  #########################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+  
 *   |    |      DA      | SA  ||TPID1 |VID||    MPLS   ||
 *   |    |00:00:00:01:18|01:15||0x8100|15 || Label:500 ||
 *   |    |              |     ||      |   || Exp:1     ||
 *   |    |              |     ||      |   || TTL:20    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:800 || Label:900 ||
 *   |    |              |              ||      |   ||Exp:1     || Exp:1     ||
 *   |    |              |              ||      |   ||TTL:20    || TTL:19    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##########################################################################
 
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *                                                      STAGE 2 - TTL COPY + EXP SET
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID|PCP||
 *   |    |00:00:00:01:18|01:15||0x8100|15 |1  ||
 *   |    |              |     ||      |   |   ||
 *   |    |              |     ||      |   |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 || Label:3000||00:00:00:01:18|01:15||0x8100|15 ||
 *   |    |              |              ||      |   ||Exp:2     || Exp:1     ||              |     ||      |   ||
 *   |    |              |              ||      |   ||TTL:20    || TTL:20    ||              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##############################################################################################
 
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||  SIP     ||  DIP          | DSCP | TTL  ||
 *   |    |11:00:00:01:11|01:15||0x8100|20 ||160.0.0.17||160.161.161.162|  4   | 64   ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * 
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||  SIP     ||  DIP          ||  TTL ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 ||160.0.0.17||160.161.161.162|| 63   ||
 *   |    |              |              ||      |   ||Exp:2     ||          ||               ||      ||
 *   |    |              |              ||      |   ||TTL:63    ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * ###############################################################################################
 
 *  #########################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+  
 *   |    |      DA      | SA  ||TPID1 |VID||    MPLS   ||
 *   |    |00:00:00:01:18|01:15||0x8100|15 || Label:500 ||
 *   |    |              |     ||      |   || Exp:1     ||
 *   |    |              |     ||      |   || TTL:20    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:800 || Label:900 ||
 *   |    |              |              ||      |   ||Exp:1     || Exp:1     ||
 *   |    |              |              ||      |   ||TTL:19    || TTL:19    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##########################################################################
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *                                                      STAGE 3 - TTL SET + EXP COPY
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID|PCP||
 *   |    |00:00:00:01:18|01:15||0x8100|15 |1  ||
 *   |    |              |     ||      |   |   ||
 *   |    |              |     ||      |   |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 || Label:3000||00:00:00:01:18|01:15||0x8100|15 ||
 *   |    |              |              ||      |   ||Exp:1     || Exp:1     ||              |     ||      |   ||
 *   |    |              |              ||      |   ||TTL:20    || TTL:20    ||              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##############################################################################################
 
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||  SIP     ||  DIP          | DSCP | TTL  ||
 *   |    |11:00:00:01:11|01:15||0x8100|20 ||160.0.0.17||160.161.161.162|  3   | 64   ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * 
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||  SIP     ||  DIP          ||  TTL ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 ||160.0.0.17||160.161.161.162|| 63   ||
 *   |    |              |              ||      |   ||Exp:4     ||          ||               ||      ||
 *   |    |              |              ||      |   ||TTL:63    ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * ###############################################################################################
 
 *  #########################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+  
 *   |    |      DA      | SA  ||TPID1 |VID||    MPLS   ||
 *   |    |00:00:00:01:18|01:15||0x8100|15 || Label:500 ||
 *   |    |              |     ||      |   || Exp:2     ||
 *   |    |              |     ||      |   || TTL:20    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:800 || Label:900 ||
 *   |    |              |              ||      |   ||Exp:2     || Exp:2     ||
 *   |    |              |              ||      |   ||TTL:19    || TTL:19    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##########################################################################
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *                                                      STAGE 4 - TTL COPY + EXP COPY
 *----------------------------------------------------------------------------------------------------------------------------------------------
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID|PCP||
 *   |    |00:00:00:01:18|01:15||0x8100|15 |3  ||
 *   |    |              |     ||      |   |   ||
 *   |    |              |     ||      |   |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||      DA      | SA  ||TPID1 |VID||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 || Label:3000||00:00:00:01:18|01:15||0x8100|15 ||
 *   |    |              |              ||      |   ||Exp:3     || Exp:3     ||              |     ||      |   ||
 *   |    |              |              ||      |   ||TTL:20    || TTL:20    ||              |     ||      |   ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##############################################################################################
 
 *  ##############################################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-  
 *   |    |      DA      | SA  ||TPID1 |VID||  SIP     ||  DIP          | DSCP | TTL  ||
 *   |    |11:00:00:01:11|01:15||0x8100|20 ||160.0.0.17||160.161.161.162|  3   | 64   ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    |              |     ||      |   ||          ||               |      |      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * 
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||  SIP     ||  DIP          ||  TTL ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:700 ||160.0.0.17||160.161.161.162|| 63   ||
 *   |    |              |              ||      |   ||Exp:4     ||          ||               ||      ||
 *   |    |              |              ||      |   ||TTL:63    ||          ||               ||      ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * ###############################################################################################
 
 *  #########################################################################
 *  Sending packet from port == 200 :   ----------->
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+  
 *   |    |      DA      | SA  ||TPID1 |VID||    MPLS   ||
 *   |    |00:00:00:01:18|01:15||0x8100|15 || Label:500 ||
 *   |    |              |     ||      |   || Exp:4     ||
 *   |    |              |     ||      |   || TTL:20    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *  
 *  Receiving packet on port == 201:   <------------
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   |    |      DA      | SA           ||TPID1 |VID||   MPLS   ||    MPLS   ||
 *   |    |00:00:00:01:15|11:00:00:01:12||0x8100|16 ||Label:800 || Label:900 ||
 *   |    |              |              ||      |   ||Exp:4     || Exp:4     ||
 *   |    |              |              ||      |   ||TTL:19    || TTL:19    ||
 *   |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 *   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 *  ##########################################################################
 */




/* Will hold all ports of the application */
int mpls_various_scenarios_port_array[2];
/* Will define which combination of egress label flags are used */
int mpls_various_scenarios_flag_mode = -1;

struct cint_mpls_various_scenarios_info_s {
    int port1; /* port1*/
    int port2; /* port2 */
    int tpid;     /* tpid value for all vlan tags in the application*/ 
    int vlan1; /* First vlan for this application */
    bcm_mac_t global_mac; /* global mac for this application */
    bcm_mac_t my_mac_lsb; /* my mac lsb for this application */
    bcm_mac_t mpls_mac; /* my mac for mpls side */
    bcm_mac_t pwe_mac1; /* mac address from first pwe*/
    bcm_mac_t pwe_mac2; /* mac address from second pwe*/
    bcm_mac_t pwe_mac3; /* mac address from third pwe*/
    bcm_mac_t vpn2_mac; /* mac address of vpn 2 */
    bcm_ip_t dip1; /* dip 1 */
    bcm_ip_t dip2; /* dip 2 */
    bcm_ip_t dip3; /* dip 3 */
    bcm_vpn_t vpn_id1; /* vpn */
    bcm_vpn_t vpn_id2; /* vpn */
    int fec1; /* fec 1*/
    int fec2; /* fec 2*/
    int fec3; /* fec 3*/
    int fec4; /* fec 4*/
    int in_tunnel_id; /* in tunnel id */
    int tunnel_id1; /* tunnel id 1*/
    int tunnel_id2; /* tunnel id 2*/
    int tunnel_id3; /* tunnel id 3*/
    int tunnel_id4; /* tunnel id 2*/
    int tunnel_id5; /* tunnel id 3*/
    int arp_encap_id1; /* ARP/LL id 1*/
    int arp_encap_id2; /* ARP/LL id 2*/
    int arp_encap_id3; /* ARP/LL id 3*/
    int arp_encap_id4; /* ARP/LL id 4*/
    int arp_encap_id5; /* ARP/LL id 5*/
    bcm_mpls_label_t pwe_label1; /* pwe label 1*/
    bcm_mpls_label_t pwe_label2; /* pwe label 2*/
    bcm_gport_t mpls_port_id1; /* mpls_port_id1*/
    bcm_gport_t mpls_port_id2; /* mpls_port_id2*/
    bcm_gport_t mpls_port_id3; /* mpls_port_id3*/
    bcm_gport_t vport_id1; /* mpls_port_id1*/
    bcm_mpls_label_t tunnel_label; /* tunnel_label */
    bcm_mpls_label_t tunnel_label2; /* tunnel_label2 */
    bcm_mpls_label_t tunnel_label3; /* tunnel_label3*/
    bcm_mpls_label_t in_swap_label; /* in_mpls_label for tunnel_switch */
    bcm_mpls_label_t out_swap_label; /* in_mpls_label for tunnel_switch */
    int exp1; /* egress label exp1 */
    int exp2; /* egress label exp2 */
};

cint_mpls_various_scenarios_info_s cint_mpls_various_scenarios_info =
/* ports :
   port1   |   port2  */
    {200,      201,
/*   tpid  */
     0x8100,
/*    vlan1  */
     16,
/*               global_mac              |            my_mac_lsb             |               mpls_mac                | */
    {0x00, 0x11, 0x00, 0x00, 0x00, 0x00}, {0x00, 0x00, 0x00, 0x00, 0x01, 0x11}, {0x00, 0x00, 0x00, 0x00, 0x01, 0x15},
/*                 pwe_mac1                                pwe_mac2                          pwe_mac3                                     vpn2_mac              */
    {0x00, 0x00, 0x00, 0x00, 0x01, 0x18}, {0x00, 0x00, 0x00, 0x00, 0x01, 0x19}, {0x00, 0x00, 0x00, 0x00, 0x01, 0x1a},  {0x00, 0x00, 0x00, 0x00, 0x01, 0x12},
/* dip 1*/
    0xA0A1A1A2/* 160.161.161.162 */,
/* dip 2*/
    0xA0A1A1A3 /* 160.161.161.163 */,
/* dip 3*/
    0xA0A1A1A4 /* 160.161.161.164 */,
/* vpn_id1   |  vpn_id2 */
    15,         16,
/* fec1    | fec 2  | fec 3 | fec 4*/
    0,          0,      0,      0,
/* in_tunnel_id */
    0,
/* tunnel_id1  | tunnel_id2  |  tunnel_id3  |  tunnel_id4  |  tunnel_id5 */
        0,            0,            0,             0,           0,
/* arp_encap_id1  | arp_encap_id2  |  arp_encap_id3  |  arp_encap_id4  |  arp_encap_id5 */
        0,            0,            0,             0,           0,
/* pwe_label1  | pwe_label2  */
       3000,       4000,
/* mpls_port_id1    |    mpls_port_id2 |  mpls_port_id3 */
        0,                    0,                0,
/* vport_id1 */
        0,
/* tunnel_label |  tunnel_label2 | tunnel_label3 */
        0,              700,            800,
/* in_swap_label |  out_swap_label */
        500,             900,
/*  exp1  |  exp2   */
     2,       1
};

/* If a specific tunnel_id is required for the POP entry, it can be set here */
int static_in_tunnel_id = -1;

void mpls_various_scenarios_info_init(int unit,
                    int port1,
                    int port2
                    ) {
    mpls_various_scenarios_port_array[0] = cint_mpls_various_scenarios_info.port1 = port1;
    mpls_various_scenarios_port_array[1] = cint_mpls_various_scenarios_info.port2 = port2;
}

/* Main function for mpls protection scnenarios */
int mpls_various_scenarios_main(int unit, int port1, int port2){
    int rv = BCM_E_NONE;

    mpls_various_scenarios_info_init(unit, port1, port2);

    /* configure vpn */
    rv = mpls_port__vswitch_vpls_vpn_create__set(unit, cint_mpls_various_scenarios_info.vpn_id1); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        printf("Error, in mpls_port__vswitch_vpls_vpn_create__set\n");
        return rv;
    }

    /* configure vpn */
    rv = mpls_port__vswitch_vpls_vpn_create__set(unit, cint_mpls_various_scenarios_info.vpn_id2); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        printf("Error, in mpls_port__vswitch_vpls_vpn_create__set\n");
        return rv;
    }

    /* Configure port properties for this application */
    rv = mpls_various_scenarios_configure_port_properties(unit, mpls_various_scenarios_port_array ,2); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_configure_port_properties\n");
        return rv;
    }

    /* Configure L2 information */
    rv = mpls_various_scenarios_create_l2_interfaces(unit);  /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_l2_interfaces\n");
        return rv;
    }
           
    /* Configure L3 information (router interfaces) */
    rv = mpls_various_scenarios_create_l3_interfaces(unit);   /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_l3_interfaces\n");
        return rv;
    }

    /* Configure mpls entries */
    rv = mpls_various_scenarios_create_egress_tunnels(unit); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_egress_tunnels\n");
        return rv;
    }

    /* Configure L3 information (router interfaces) */
    rv = mpls_various_scenarios_create_fec_entries(unit);  /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_fec_entries\n");
        return rv;
    }

    /* Configure tunnel switch entry */
    rv = mpls_various_scenarios_configure_tunnel_switch(unit); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_configure_tunnel_switch\n");
        return rv;
    }

    /* Configure tunnel switch entry */
    rv = mpls_various_scenarios_configure_tunnel_switch_pop(unit); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_configure_tunnel_switch_pop\n");
        return rv;
    }

    /* Configure pwe entries */
    rv = mpls_various_scenarios_create_pwe_entries(unit); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_pwe_entries\n");
        return rv;
    }

    /* Create l2 forwarding entries */
    rv = mpls_various_scenarios_create_l2_forwarding(unit);  /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_l2_forwarding\n");
        return rv;
    }

    /* Create l3 forwarding entries */
    rv = mpls_various_scenarios_create_l3_forwarding(unit);  /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls_various_scenarios_create_l3_forwarding\n");
        return rv;
    }

    return rv;
}

/* Configure a tunnel SWAP and PUSH for MPLS encapsulated packets */
int mpls_various_scenarios_configure_tunnel_switch(int unit) {
    mpls__ingress_tunnel_utils_s switch_entry;
    int rv;

    switch_entry.action = BCM_MPLS_SWITCH_ACTION_SWAP;
    switch_entry.fec = cint_mpls_various_scenarios_info.fec4;
    switch_entry.label = cint_mpls_various_scenarios_info.in_swap_label;
    switch_entry.swap_label = cint_mpls_various_scenarios_info.out_swap_label;
    switch_entry.vpn = cint_mpls_various_scenarios_info.vpn_id1;

    rv = mpls__add_switch_entry(unit, &switch_entry); /* 2 */
    if(rv != BCM_E_NONE) {
        printf("Error, in bcm_mpls_tunnel_switch_create,\n");
        return rv;
    }

    return rv;
}

/* Configure a tunnel POP for MPLS encapsulated packets */
int mpls_various_scenarios_configure_tunnel_switch_pop(int unit) {
    mpls__ingress_tunnel_utils_s switch_entry;
    int rv;
    int mpls_label_indexed_enable = soc_property_get(unit , "mpls_termination_label_index_enable",0);

    switch_entry.action = BCM_MPLS_SWITCH_ACTION_POP;
    switch_entry.label = cint_mpls_various_scenarios_info.tunnel_label2;
    if (mpls_label_indexed_enable) {
         int label_val = cint_mpls_various_scenarios_info.tunnel_label2;
         BCM_MPLS_INDEXED_LABEL_SET(switch_entry.label, label_val, 1);
    }
    if (static_in_tunnel_id != -1) {
        switch_entry.flags = BCM_MPLS_SWITCH_WITH_ID;
        switch_entry.tunnel_id = static_in_tunnel_id;
    }

    rv = mpls__add_switch_entry(unit, &switch_entry); /* 2 */
    if(rv != BCM_E_NONE) {
        printf("Error, in bcm_mpls_tunnel_switch_create,\n");
        return rv;
    }

    printf("in lif is: %d\n",switch_entry.tunnel_id);

    cint_mpls_various_scenarios_info.in_tunnel_id = switch_entry.tunnel_id;

    return rv;
}

/* Configure properties for ports of the application */
int mpls_various_scenarios_configure_port_properties(int unit, int *port_array, int nof_ports){
    int rv = BCM_E_NONE;
    int i;
    bcm_pbmp_t pbmp;

    for (i=0; i< nof_ports; i++) {
        /* set VLAN domain to each port */
        rv = port__vlan_domain__set(unit, port_array[i], port_array[i]); /* 1 */  /* 2 */
        if (rv != BCM_E_NONE) {
            printf("Error, in port__vlan_domain__set, port=%d, \n", port_array[i]);
            return rv;
        }

        /* Set outer and inner tpid */
        rv = port__tpid__set(unit, port_array[i], cint_mpls_various_scenarios_info.tpid, cint_mpls_various_scenarios_info.tpid); /* 1 */  /* 2 */
        if (rv != BCM_E_NONE) {
            printf("Error, in port__tpid__set, port=%d, \n",  port_array[i]);
            return rv;
        }

        rv = bcm_vlan_gport_add(unit, cint_mpls_various_scenarios_info.vpn_id1, port_array[i], BCM_VLAN_GPORT_ADD_INGRESS_ONLY); /* 1 */  /* 2 */
        if (rv != BCM_E_NONE && rv != BCM_E_EXISTS) {
            printf("fail add port(0x%08x) to vlan(%d)\n", in_sysport, vlan);
          return rv;
        }
    }

    return rv;
}


/* Create attachment circuits  */
int mpls_various_scenarios_create_l2_interfaces(int unit){
    int rv = BCM_E_NONE;
    int flags = 0;

    /* Create a vlan port*/
    rv = l2__port_vlan__create(unit, flags,  cint_mpls_various_scenarios_info.port1, cint_mpls_various_scenarios_info.vlan1, 0, &cint_mpls_various_scenarios_info.vport_id1); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l2__port_vlan__create\n");
        return rv;
    }
    printf("vlan gport created:0x%x\n", cint_mpls_various_scenarios_info.vport_id1);
    /* Attach vlan port to vpn */
    rv = bcm_vswitch_port_add(unit, cint_mpls_various_scenarios_info.vpn_id1, cint_mpls_various_scenarios_info.vport_id1); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        printf("Error, bcm_vswitch_port_add\n");
        return rv;
    }

    /* Add vlan port to flooding group */
    rv = multicast__vlan_port_add(unit, cint_mpls_various_scenarios_info.vpn_id1, cint_mpls_various_scenarios_info.port1 , cint_mpls_various_scenarios_info.vport_id1, 0); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        printf("Error, multicast__vlan_port_add\n");
        return rv;
    }

    return rv;
}

/* Configure L3information (router interfaces) */
int mpls_various_scenarios_create_l3_interfaces(int unit){
    int rv = BCM_E_NONE;
    create_l3_intf_s l3_intf[2];
    create_l3_egress_s l3_egress;

    l3_intf[0].my_lsb_mac = cint_mpls_various_scenarios_info.my_mac_lsb;
    l3_intf[0].my_global_mac = cint_mpls_various_scenarios_info.global_mac;
    l3_intf[0].rif = cint_mpls_various_scenarios_info.vpn_id1;
    l3_intf[0].vsi = cint_mpls_various_scenarios_info.vpn_id1;
    l3_intf[0].rpf_valid = 0;

    /* create rif */
    rv = l3__intf_rif__create(unit, &(l3_intf[0])); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l3__intf_rif__create\n");
        return rv;
    }
    
    l3_intf[1].my_lsb_mac = cint_mpls_various_scenarios_info.vpn2_mac;
    l3_intf[1].my_global_mac = cint_mpls_various_scenarios_info.global_mac;
    l3_intf[1].rif = cint_mpls_various_scenarios_info.vpn_id2;
    l3_intf[1].vsi = cint_mpls_various_scenarios_info.vpn_id2;
    l3_intf[1].rpf_valid = 0;

    /* create rif */
    rv = l3__intf_rif__create(unit, &(l3_intf[1])); /* 1 */  /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l3__intf_rif__create\n");
        return rv;
    }

    rv = BCM_E_NONE;
    return rv;
}

/* Create MACT entries*/
int mpls_various_scenarios_create_l2_forwarding(int unit){
    int rv = BCM_E_NONE;
    l2__mact_properties_s mact_properties[3];

    mact_properties[0].gport_id = cint_mpls_various_scenarios_info.mpls_port_id1;
    mact_properties[0].mac_address = cint_mpls_various_scenarios_info.pwe_mac1;
    mact_properties[0].vlan = cint_mpls_various_scenarios_info.vpn_id1;
    rv = l2__mact_entry_create(unit, &(mact_properties[0])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l2__mact_entry_create\n");
        return rv;
    }

    mact_properties[1].gport_id = cint_mpls_various_scenarios_info.mpls_port_id2;
    mact_properties[1].mac_address = cint_mpls_various_scenarios_info.pwe_mac2;
    mact_properties[1].vlan = cint_mpls_various_scenarios_info.vpn_id1;
    rv = l2__mact_entry_create(unit, &(mact_properties[1])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l2__mact_entry_create\n");
        return rv;
    }

    mact_properties[2].gport_id = cint_mpls_various_scenarios_info.mpls_port_id3;
    mact_properties[2].mac_address = cint_mpls_various_scenarios_info.pwe_mac3;
    mact_properties[2].vlan = cint_mpls_various_scenarios_info.vpn_id1;
    rv = l2__mact_entry_create(unit, &(mact_properties[2])); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l2__mact_entry_create\n");
        return rv;
    }

    return rv;
}

/* Create routing entries */
int mpls_various_scenarios_create_l3_forwarding(int unit){
    int rv = BCM_E_NONE;
    l3_ipv4_route_entry_utils_s route_entry[3];

    printf("cint_mpls_various_scenarios_info.dip1: %d\n\n",cint_mpls_various_scenarios_info.dip1);
    route_entry[0].address =  cint_mpls_various_scenarios_info.dip1;
    route_entry[0].mask = 0xffffffff;
    rv = l3__ipv4_route__add(unit,
                             route_entry[0],
                             0,     /* router instance */
                             cint_mpls_various_scenarios_info.fec1/* data of LPM entry:  fec */
                             );  /* 1 */
    if (rv != BCM_E_NONE) {
        printf("Error, in l3__ipv4_route__add\n");
        return rv;
    }

    route_entry[1].address =  cint_mpls_various_scenarios_info.dip2;
    route_entry[1].mask = 0xffffffff;
    rv = l3__ipv4_route__add(unit,
                             route_entry[1],
                             0,     /* router instance */
                             cint_mpls_various_scenarios_info.fec2/* data of LPM entry:  fec */
                             );  /* 1 */
    if (rv != BCM_E_NONE) {
        printf("Error, in l3__ipv4_route__add\n");
        return rv;
    }


    route_entry[2].address =  cint_mpls_various_scenarios_info.dip3;
    route_entry[2].mask = 0xffffffff;
    rv = l3__ipv4_route__add(unit,
                             route_entry[2],
                             0,     /* router instance */
                             cint_mpls_various_scenarios_info.fec3/* data of LPM entry:  fec */
                             );  /* 2 */
    if (rv != BCM_E_NONE) {
        printf("Error, in l3__ipv4_route__add\n");
        return rv;
    }

    return rv;
}

/* Create egress mpls entries (in the EEDB) */
int mpls_various_scenarios_create_egress_tunnels(int unit){
    int rv = BCM_E_NONE;
    mpls__egress_tunnel_utils_s mpls_tunnel_properties[5];
    int egress_label_flags;
    int tunnel_index = 0;
    qax_egress_label_custom_flags = 1;

    if(mpls_various_scenarios_flag_mode == 0) {
        egress_label_flags = BCM_MPLS_EGRESS_LABEL_TTL_SET|BCM_MPLS_EGRESS_LABEL_EXP_SET;
    } else if(mpls_various_scenarios_flag_mode == 1){
        egress_label_flags = BCM_MPLS_EGRESS_LABEL_TTL_COPY|BCM_MPLS_EGRESS_LABEL_EXP_SET;
    } else if(mpls_various_scenarios_flag_mode == 2){
        egress_label_flags = BCM_MPLS_EGRESS_LABEL_TTL_SET|BCM_MPLS_EGRESS_LABEL_EXP_COPY;
    } else if(mpls_various_scenarios_flag_mode == 3) {
        egress_label_flags = BCM_MPLS_EGRESS_LABEL_TTL_COPY|BCM_MPLS_EGRESS_LABEL_EXP_COPY;
    }

    /* Build an EEDB entry with two tunnels (labels equal to 0)*/
    mpls_tunnel_properties[tunnel_index].label_in = cint_mpls_various_scenarios_info.tunnel_label;
    mpls_tunnel_properties[tunnel_index].label_out = cint_mpls_various_scenarios_info.tunnel_label;
    mpls_tunnel_properties[tunnel_index].label_out_2 = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].label_out_3 = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].egress_action = BCM_MPLS_EGRESS_ACTION_PUSH;
    mpls_tunnel_properties[tunnel_index].with_exp = 1;
    mpls_tunnel_properties[tunnel_index].exp = 2;
    mpls_tunnel_properties[tunnel_index].ttl = 20;
    mpls_tunnel_properties[tunnel_index].ext_exp = 4;
    mpls_tunnel_properties[tunnel_index].ext_ttl = 20;
    mpls_tunnel_properties[tunnel_index].next_pointer_intf = cint_mpls_various_scenarios_info.vpn_id2;

    /* Create egress tunnel */
    rv  = mpls__create_tunnel_initiator__set(unit, &(mpls_tunnel_properties[tunnel_index])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls__create_tunnel_initiator__set\n");
        return rv;
    }
    cint_mpls_various_scenarios_info.tunnel_id1 = mpls_tunnel_properties[tunnel_index].tunnel_id;
    tunnel_index++;

    /* Build an EEDB entry with two tunnels (labels equal to 0)*/
    mpls_tunnel_properties[tunnel_index].label_in = cint_mpls_various_scenarios_info.tunnel_label;
    mpls_tunnel_properties[tunnel_index].label_out = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].label_out_2 = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].label_out_3 = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].egress_action = BCM_MPLS_EGRESS_ACTION_PUSH;
    mpls_tunnel_properties[tunnel_index].next_pointer_intf = cint_mpls_various_scenarios_info.vpn_id2;
    /* Create egress tunnel */
    rv  = mpls__create_tunnel_initiator__set(unit, &(mpls_tunnel_properties[tunnel_index])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls__create_tunnel_initiator__set\n");
        return rv;
    }
    cint_mpls_various_scenarios_info.tunnel_id2 = mpls_tunnel_properties[tunnel_index].tunnel_id;
    tunnel_index++;

    /* Build an EEDB entry with two tunnels (labels equal to 0)*/
    mpls_tunnel_properties[tunnel_index].label_in = cint_mpls_various_scenarios_info.tunnel_label;
    mpls_tunnel_properties[tunnel_index].label_out = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].egress_action = BCM_MPLS_EGRESS_ACTION_PUSH;
    mpls_tunnel_properties[tunnel_index].next_pointer_intf = cint_mpls_various_scenarios_info.vpn_id2;
    /* Create egress tunnel */
    rv  = mpls__create_tunnel_initiator__set(unit, &(mpls_tunnel_properties[tunnel_index])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls__create_tunnel_initiator__set\n");
        return rv;
    }
    cint_mpls_various_scenarios_info.tunnel_id3 = mpls_tunnel_properties[tunnel_index].tunnel_id; 
    tunnel_index++;

    /* Build an EEDB entry with one tunnel (labels equal to 700)*/
    mpls_tunnel_properties[tunnel_index].label_in = cint_mpls_various_scenarios_info.tunnel_label2;
    mpls_tunnel_properties[tunnel_index].flags = egress_label_flags;
    mpls_tunnel_properties[tunnel_index].force_flags = 1;
    mpls_tunnel_properties[tunnel_index].with_exp = 1;
    mpls_tunnel_properties[tunnel_index].exp = cint_mpls_various_scenarios_info.exp1;
    mpls_tunnel_properties[tunnel_index].label_out = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].egress_action = BCM_MPLS_EGRESS_ACTION_PUSH;
    mpls_tunnel_properties[tunnel_index].next_pointer_intf = cint_mpls_various_scenarios_info.vpn_id2;
    /* Create egress tunnel */
    rv  = mpls__create_tunnel_initiator__set(unit, &(mpls_tunnel_properties[tunnel_index])); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls__create_tunnel_initiator__set\n");
        return rv;
    }
    cint_mpls_various_scenarios_info.tunnel_id4 = mpls_tunnel_properties[tunnel_index].tunnel_id; 
    tunnel_index++;

    /* Build an EEDB entry with one tunnel (labels equal to 800)*/
    mpls_tunnel_properties[tunnel_index].label_in = cint_mpls_various_scenarios_info.tunnel_label3;
    mpls_tunnel_properties[tunnel_index].with_exp = 1;
    mpls_tunnel_properties[tunnel_index].flags = egress_label_flags;
    mpls_tunnel_properties[tunnel_index].force_flags = 1;
    mpls_tunnel_properties[tunnel_index].exp = cint_mpls_various_scenarios_info.exp2;
    mpls_tunnel_properties[tunnel_index].label_out = mpls_default_egress_label_value;
    mpls_tunnel_properties[tunnel_index].egress_action = BCM_MPLS_EGRESS_ACTION_PUSH;
    mpls_tunnel_properties[tunnel_index].next_pointer_intf = cint_mpls_various_scenarios_info.vpn_id2;
    /* Create egress tunnel */
    rv  = mpls__create_tunnel_initiator__set(unit, &(mpls_tunnel_properties[tunnel_index])); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in mpls__create_tunnel_initiator__set\n");
        return rv;
    }
    cint_mpls_various_scenarios_info.tunnel_id5 = mpls_tunnel_properties[tunnel_index].tunnel_id;
    tunnel_index++;

    return rv;
}

/* Configure fec entries */
int mpls_various_scenarios_create_fec_entries(int unit){
    int rv = BCM_E_NONE;
    create_l3_egress_s l3_egress[4];

    /* Set LL for egress tunnel */
    l3_egress[0].fec_id = 0;
    l3_egress[0].arp_encap_id = 0;
    l3_egress[0].out_gport = cint_mpls_various_scenarios_info.port2;
    l3_egress[0].vlan = cint_mpls_various_scenarios_info.vlan1; /* next hop vlan*/
    l3_egress[0].out_tunnel_or_rif = cint_mpls_various_scenarios_info.tunnel_id1; /* tunnel */
    l3_egress[0].next_hop_mac_addr = cint_mpls_various_scenarios_info.mpls_mac;
    l3_egress[0].failover_id = 0;
    l3_egress[0].failover_if_id = 0;
    rv = l3__egress__create(unit, &(l3_egress[0])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l3__egress__create\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.fec1 = l3_egress[0].fec_id;
    cint_mpls_various_scenarios_info.arp_encap_id1 = l3_egress[0].arp_encap_id;
    printf("ARP encap ID is 0x%x\n", cint_mpls_various_scenarios_info.arp_encap_id1);
   /* Set LL for egress tunnel */
    l3_egress[1].fec_id = 0;
    l3_egress[1].arp_encap_id = 0;
    l3_egress[1].out_gport = cint_mpls_various_scenarios_info.port2;
    l3_egress[1].vlan = cint_mpls_various_scenarios_info.vlan1; /* next hop vlan*/
    l3_egress[1].out_tunnel_or_rif = cint_mpls_various_scenarios_info.tunnel_id2; /* tunnel */
    l3_egress[1].next_hop_mac_addr = cint_mpls_various_scenarios_info.mpls_mac;
    rv = l3__egress__create(unit, &(l3_egress[1])); /* 1 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l3__egress__create\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.fec2 = l3_egress[1].fec_id;
    cint_mpls_various_scenarios_info.arp_encap_id2 = l3_egress[1].arp_encap_id;
    printf("ARP encap ID2 is 0x%x\n", cint_mpls_various_scenarios_info.arp_encap_id2);

    l3_egress[2].fec_id = 0;
    l3_egress[2].arp_encap_id = 0;
    l3_egress[2].out_gport = cint_mpls_various_scenarios_info.port2;
    l3_egress[2].vlan = cint_mpls_various_scenarios_info.vlan1; /* next hop vlan*/
    l3_egress[2].out_tunnel_or_rif = cint_mpls_various_scenarios_info.tunnel_id4; /* tunnel */
    l3_egress[2].next_hop_mac_addr = cint_mpls_various_scenarios_info.mpls_mac;
    rv = l3__egress__create(unit, &(l3_egress[2])); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l3__egress__create\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.fec3 = l3_egress[2].fec_id;
    cint_mpls_various_scenarios_info.arp_encap_id3 = l3_egress[2].arp_encap_id;
    printf("ARP encap ID3 is 0x%x\n", cint_mpls_various_scenarios_info.arp_encap_id3);

    l3_egress[3].fec_id = 0;
    l3_egress[3].arp_encap_id = 0;
    l3_egress[3].out_gport = cint_mpls_various_scenarios_info.port2;
    l3_egress[3].vlan = cint_mpls_various_scenarios_info.vlan1; /* next hop vlan*/
    l3_egress[3].out_tunnel_or_rif = cint_mpls_various_scenarios_info.tunnel_id5; /* tunnel */
    l3_egress[3].next_hop_mac_addr = cint_mpls_various_scenarios_info.mpls_mac;
    rv = l3__egress__create(unit, &(l3_egress[3])); /* 2 */
    if (rv != BCM_E_NONE) {
        print rv;
        printf("Error, in l3__egress__create\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.fec4 = l3_egress[3].fec_id;
    cint_mpls_various_scenarios_info.arp_encap_id4 = l3_egress[3].arp_encap_id;
    printf("ARP encap ID4 is 0x%x\n", cint_mpls_various_scenarios_info.arp_encap_id4);

    return rv;
}

/* Configure pwe entries */
int mpls_various_scenarios_create_pwe_entries(int unit){
    int rv = BCM_E_NONE;
    mpls__egress_tunnel_utils_s mpls_tunnel_properties;
    mpls_port_utils_s mpls_port_properties[3];
    bcm_if_t pwe_encap_id;
    bcm_mpls_egress_label_t label_array[2];
    int label_count;

    /* Create regular pwe entry (one pwe label, no mpls label in second half entry) */
    mpls_port_properties[0].egress_pwe_label = cint_mpls_various_scenarios_info.pwe_label1;
    mpls_port_properties[0].egress_mpls_tunnel_id = cint_mpls_various_scenarios_info.tunnel_id1;
    mpls_port_properties[0].vpn = cint_mpls_various_scenarios_info.vpn_id1;
    mpls_port_properties[0].port = cint_mpls_various_scenarios_info.port1;
    rv = mpls_port__mp_create_ingress_egress_mpls_port(unit, &(mpls_port_properties[0])); /* 1 */
    if (rv != BCM_E_NONE) {
        printf("Error, in mpls_port__mp_create_ingress_egress_mpls_port\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.mpls_port_id1 = mpls_port_properties[0].mpls_port_id;

    /* Create a Pwe entry binded with a mpls label*/
    mpls_port_properties[1].egress_pwe_label = cint_mpls_various_scenarios_info.pwe_label2;
    mpls_port_properties[1].vpn = cint_mpls_various_scenarios_info.vpn_id1;
    mpls_port_properties[1].port = cint_mpls_various_scenarios_info.port1;
    mpls_port_properties[1].egress_mpls_tunnel_id = cint_mpls_various_scenarios_info.tunnel_id1;

    rv = mpls_port__mp_create_ingress_egress_mpls_port(unit, &(mpls_port_properties[1])); /* 1 */
    if (rv != BCM_E_NONE) {
        printf("Error, in mpls_port__mp_create_ingress_egress_mpls_port\n");
        return rv;
    }

    /* Create regular pwe entry  */
    mpls_port_properties[2].egress_pwe_label = cint_mpls_various_scenarios_info.pwe_label1;
    mpls_port_properties[2].egress_label_flags = BCM_MPLS_EGRESS_LABEL_EXP_COPY|BCM_MPLS_EGRESS_LABEL_TTL_SET;
    mpls_port_properties[2].egress_mpls_tunnel_id = cint_mpls_various_scenarios_info.tunnel_id4;
    mpls_port_properties[2].vpn = cint_mpls_various_scenarios_info.vpn_id1;
    mpls_port_properties[2].port = cint_mpls_various_scenarios_info.port1;
    rv = mpls_port__mp_create_ingress_egress_mpls_port(unit, &(mpls_port_properties[2])); /* 2 */
    if (rv != BCM_E_NONE) {
        printf("Error, in mpls_port__mp_create_ingress_egress_mpls_port\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.mpls_port_id3 = mpls_port_properties[2].mpls_port_id;

    bcm_mpls_egress_label_t_init(&label_array[0]);
    bcm_mpls_egress_label_t_init(&label_array[1]);

    BCM_L3_ITF_SET(pwe_encap_id, BCM_L3_ITF_TYPE_LIF, mpls_port_properties[1].encap_id);
    rv = bcm_mpls_tunnel_initiator_get(unit, pwe_encap_id, 1, &label_array, &label_count); /* 1 */
    if (rv != BCM_E_NONE) {
        printf("Error, in bcm_mpls_tunnel_initiator_get\n");
        return rv;
    }

    label_count = 2;
    /* PWE label - leaving as is */
    label_array[0].flags |= BCM_MPLS_EGRESS_LABEL_WITH_ID | BCM_MPLS_EGRESS_LABEL_REPLACE;
    /* Add MPLS label in the second place in the same EEDB entry */
    label_array[1].flags |= BCM_MPLS_EGRESS_LABEL_WITH_ID | BCM_MPLS_EGRESS_LABEL_REPLACE;
    label_array[1].flags |= BCM_MPLS_EGRESS_LABEL_TTL_SET|BCM_MPLS_EGRESS_LABEL_TTL_DECREMENT;
    label_array[1].tunnel_id = pwe_encap_id;
    label_array[1].l3_intf_id = cint_mpls_various_scenarios_info.vpn_id2;
    label_array[1].label = 0;
    label_array[1].ttl = 20;

    rv = bcm_mpls_tunnel_initiator_create(unit, 0, label_count, label_array); /* 1 */
    if (rv != BCM_E_NONE) {
        printf("Error, in bcm_mpls_tunnel_initiator_create\n");
        return rv;
    }

    cint_mpls_various_scenarios_info.mpls_port_id2 = mpls_port_properties[1].mpls_port_id;

    return rv;
}
